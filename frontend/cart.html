<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Cart</title>
  <link rel="stylesheet" href="cart.css">
  <script src="script2.js" defer></script>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="pets.html">Pets</a>
    <a href="adopt.html">Adopt</a>
    <a href="petfood.html">Pet Food</a>
    <a href="cart.html">Cart (<span id="cartCount">0</span>)</a>
  </nav>

  <main class="cart-main">
    <h1>Your Shopping Cart ðŸ›’</h1>

    <div id="cartContainer" class="cart-container">
      <!-- Items will be injected here -->
    </div>

    <aside class="cart-summary">
      <div class="summary-row">
        <span>Subtotal</span>
        <span id="subtotal">â‚¹0</span>
      </div>
      <div class="summary-row">
        <span>Shipping</span>
        <span id="shipping">â‚¹0</span>
      </div>
      <div class="summary-row total-row">
        <strong>Total</strong>
        <strong id="total">â‚¹0</strong>
      </div>

      <div class="summary-actions">
        <button id="clearCartBtn" class="btn secondary">Clear Cart</button>
        <button id="checkoutBtn" class="btn primary" disabled>Proceed to Checkout</button>
      </div>
    </aside>

    <div id="emptyNotice" class="empty-notice" hidden>
      <p>Your cart is empty!</p>
      <a href="petfood.html" class="btn">Shop Pet Food</a>
    </div>
  </main>

  <footer>
    <p>Â© 2025 Pet Care</p>
  </footer>

  <script>
    // Cart behaviour
    const cartContainer = document.getElementById("cartContainer");
    const cartCountEl = document.getElementById("cartCount");
    const subtotalEl = document.getElementById("subtotal");
    const shippingEl = document.getElementById("shipping");
    const totalEl = document.getElementById("total");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");
    const emptyNotice = document.getElementById("emptyNotice");

    // Load cart from localStorage. Each item: { id, name, price, qty, img(optional) }
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function updateCartCount() {
      cartCountEl.textContent = cart.reduce((s, it) => s + (it.qty || 1), 0);
    }

    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
    }

    function formatRupee(n) {
      return "â‚¹" + Number(n).toLocaleString("en-IN", { maximumFractionDigits: 0 });
    }

    function computeTotals() {
      const subtotal = cart.reduce((s, it) => s + (Number(it.price) || 0) * (it.qty || 1), 0);
      // simple shipping rule: free over 1000 else 50
      const shipping = subtotal === 0 ? 0 : (subtotal > 1000 ? 0 : 50);
      const total = subtotal + shipping;
      subtotalEl.textContent = formatRupee(subtotal);
      shippingEl.textContent = formatRupee(shipping);
      totalEl.textContent = formatRupee(total);
      return { subtotal, shipping, total };
    }

    function renderCart() {
      cartContainer.innerHTML = "";
      if (!cart || cart.length === 0) {
        emptyNotice.hidden = false;
        checkoutBtn.disabled = true;
        subtotalEl.textContent = "â‚¹0";
        shippingEl.textContent = "â‚¹0";
        totalEl.textContent = "â‚¹0";
        return;
      }
      emptyNotice.hidden = true;

      cart.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "cart-item";

        // image (optional)
        const imgHtml = item.img ? `<div class="ci-img"><img src="${item.img}" alt="${item.name}"></div>` : "";

        div.innerHTML = `
          ${imgHtml}
          <div class="ci-body">
            <h3>${item.name}</h3>
            <p class="ci-price">Price: ${formatRupee(item.price)}</p>
            <div class="ci-qty">
              <button class="qty-decr" data-index="${index}">-</button>
              <input type="number" class="qty-input" data-index="${index}" min="1" value="${item.qty || 1}">
              <button class="qty-incr" data-index="${index}">+</button>
            </div>
          </div>
          <div class="ci-actions">
            <p class="ci-line-total">${formatRupee((item.price) * (item.qty || 1))}</p>
            <button class="remove-btn" data-index="${index}">Remove</button>
          </div>
        `;
        cartContainer.appendChild(div);
      });

      // wire up controls
      document.querySelectorAll(".remove-btn").forEach(btn => btn.addEventListener("click", (e) => {
        const idx = parseInt(e.currentTarget.dataset.index);
        cart.splice(idx, 1);
        saveCart();
        renderCart();
        computeTotals();
      }));
      document.querySelectorAll(".qty-incr").forEach(btn => btn.addEventListener("click", (e) => {
        const idx = parseInt(e.currentTarget.dataset.index);
        cart[idx].qty = (cart[idx].qty || 1) + 1;
        saveCart();
        renderCart();
        computeTotals();
      }));
      document.querySelectorAll(".qty-decr").forEach(btn => btn.addEventListener("click", (e) => {
        const idx = parseInt(e.currentTarget.dataset.index);
        cart[idx].qty = Math.max(1, (cart[idx].qty || 1) - 1);
        saveCart();
        renderCart();
        computeTotals();
      }));
      document.querySelectorAll(".qty-input").forEach(input => input.addEventListener("change", (e) => {
        const idx = parseInt(e.currentTarget.dataset.index);
        let v = parseInt(e.currentTarget.value) || 1;
        v = Math.max(1, v);
        cart[idx].qty = v;
        saveCart();
        renderCart();
        computeTotals();
      }));

      checkoutBtn.disabled = false;
    }

    clearCartBtn.addEventListener("click", () => {
      if (!confirm("Clear all items from cart?")) return;
      cart = [];
      saveCart();
      renderCart();
      computeTotals();
    });

    checkoutBtn.addEventListener("click", () => {
      // Save totals and redirect to checkout page where checkout.html will read the cart again
      const totals = computeTotals();
      localStorage.setItem("orderTotals", JSON.stringify(totals));
      // Navigate to checkout page
      window.location.href = "checkout.html";
    });

    // initial
    updateCartCount();
    renderCart();
    computeTotals();
  </script>
</body>
</html>
